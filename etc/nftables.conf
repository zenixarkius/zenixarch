#!/usr/bin/nft -f
# vim:set ts=2 sw=2 et:

flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;

        ct state invalid drop
        ct state established,related accept

        iif "lo" accept

        ip protocol icmp accept
        ip6 nexthdr icmpv6 accept

        udp sport 67 udp dport 68 accept
        udp sport 68 udp dport 67 accept

        jump logging_input
    }

    chain forward {
        type filter hook forward priority 0; policy drop;

        jump logging_forward
    }

    chain output {
        type filter hook output priority 0; policy drop;

        ct state established,related accept

        oif "lo" accept

        ip protocol icmp accept
        ip6 nexthdr icmpv6 accept

        tcp dport { 80, 443, 7844 } accept
        udp dport { 443, 123, 7844, 51820 } accept

        jump logging_output
    }

    chain logging_forward {
        limit rate 5/minute log prefix "[DROP FWD] "
        drop
    }

    chain logging_input {
        limit rate 5/minute log prefix "[DROP IN] "
        drop
    }

    chain logging_output {
        limit rate 5/minute log prefix "[DROP OUT] "
        drop
    }
}
